
@{
    string pending = "Pending";
    string approved = "Approved";
    string denied = "Denied";
    string completed = "Completed";
    ViewBag.Title = "Records";
    Layout = "~/Views/Layout/BossManagerLayout.cshtml";
}
<script>
    $(document).ready(function () {
        $('#maincontent').empty();
        $('#maincontent1').empty();
        $('#containerChart').empty();
        
    });</script>
<div id="content1">
    <div class="container">
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title"><span id="eventTitle"></span></h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="rid" id="rid" />
                        <input type="hidden" name="rfid" id="rfid" />
                        <p id="pDetails"></p>
                        <br /><br />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br /><br />
   
    <br />
    <div class="panel panel-default">
        <div class="container">
            <center><h2>Reversal List</h2></center>
            <center>
                <b>Category</b> <select class="form-control" id="cboType" onchange="ChangeBy()">
                    <option value="Monthly">Monthly</option>
                    <option value="Yearly">Yearly</option>
                </select>
            </center>
            <br />
            <center>
                <b>Year :</b>
                <select id="textyear1" name="textyear1" onchange="ChangeBy()">
                    <option value="2018">2018</option>
                </select>
                <b>Month :</b><select id="monthly" onchange="ChangeBy()">
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
            </center>
            <div class="pull-left">
                <label id="caption" name="caption"></label>
            </div>
            <div class="pull-right">
                <div class="btn-group">

                    <button type="button" class="btn btn-primary btn-filter " value="Approved" onclick="Set('@approved')">Approved</button>
                    <button type="button" class="btn btn-warning btn-filter " value="Pending" onclick="Set('@pending')">Pending</button>
                    <button type="button" class="btn btn-danger btn-filter" value="Denied" onclick="Set('@denied')">Denied</button>
                    <button type="button" class="btn btn-success btn-filter" value="Completed" onclick="Set('@completed')">Completed</button>

                </div>
            </div>
            <br />
            <br />

            <table class="table table-bordered table-striped" id="tableReversalList"></table>


        </div>
    </div>

</div>

    @section scripts{
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <script>
            var global = '';
            $(document).ready(SetP());
            $(document).ready(function () {
                var content1 = document.getElementById('content1');
                $('#maincontent1').append(content1);

            });
            function ChangeBy() {
                if (global == "Pending") {
                    SetP();
                }
                else if (global == "Approved") {
                    SetA();
                }
                else if (global == "Denied") {
                    SetD();
                }
                else {
                    SetC();
                }
            }
            function SetP() {
                var s = 'Pending';
                var tp = document.getElementById('cboType').value;
                var textyear = document.getElementById('textyear1').value;
                var monthly = document.getElementById('monthly').value;
                global = s;
                document.getElementById('caption').innerHTML = 'List of ' + s;
                $.ajax({
                    type: 'POST',
                    url: '/ReversalRecord/GetP',
                    data: { "type": tp, "month": monthly, "year": textyear },
                    success: function (data) {
                        $('#tableReversalList').empty();
                        trHTML = '<tr><th>Date</th> <th>Created By</th> <th>Reserved By</th> <th>Date of Reservation</th> <th>Amount</th><th>Description</th><th>Status</th><th>Change Status</th></tr>';
                        $.each(data, function (i, v) {

							trHTML += '<tr><td>' + v.Date + '</td><td>' + v.CreatedBy + '</td><td>' + v.Fullname + '</td><td>' + v.DateofReservation + '</td><td>' + v.Amount + '</td><td>' + v.Description + '</td><td>' + v.Status + '</td><td><select id="rstatus'+v.Id+'" onchange="UpdateStatus(' + v.Id + ')"> <option value="" selected disabled hidden>' + v.Status + '</option><option value="Approved">Approved</option><option value="Denied">Denied</option></select></td><td><button class="btn btn-default" id="btnViewModal" onclick="ViewModal(' + v.RefNo + ')">View Details</button></td></tr>';

                        });
                        $('#tableReversalList').append(trHTML);
                        trHTML = '';

                    },
                    error: function (error) {
                        alert('Failed to retrieve record');
                    }
                });
            }

            function SetA() {
                var s = 'Approved';
                var tp = document.getElementById('cboType').value;
                var textyear = document.getElementById('textyear1').value;
                var monthly = document.getElementById('monthly').value;
                global = s;
                $.ajax({
                    type: 'POST',
                    url: '/ReversalRecord/GetA',
                    data: { "type": tp, "month": monthly, "year": textyear },
                    success: function (data) {
                        $('#tableReversalList').empty();
                        trHTML = '<tr><th>Date</th> <th>Created By</th> <th>Reserved By</th> <th>Date of Reservation</th> <th>Amount</th><th>Description</th><th>Status</th><th>Change Status</th></tr>';
                        $.each(data, function (i, v) {

							trHTML += '<tr><td>' + v.Date + '</td><td>' + v.CreatedBy + '</td><td>' + v.Fullname + '</td><td>' + v.DateofReservation + '</td><td>' + v.Amount + '</td><td>' + v.Description + '</td><td>' + v.Status + '</td><td><select id="rstatus'+v.Id+'" onchange="UpdateStatus(' + v.Id + ')"> <option value="" selected disabled hidden>' + v.Status + '</option><option value="Approved">Approved</option><option value="Denied">Denied</option></select></td><td><button class="btn btn-default" id="btnViewModal" onclick="ViewModal(' + v.RefNo + ')">View Details</button></td></tr>';

                        });
                        $('#tableReversalList').append(trHTML);
                        trHTML = '';

                    },
                    error: function (error) {
                        alert('Failed to retrieve record');
                    }
                });
            }
            function SetD() {
                var s = 'Denied';
                var tp = document.getElementById('cboType').value;
                var textyear = document.getElementById('textyear1').value;
                var monthly = document.getElementById('monthly').value;
                global = s;
                $.ajax({
                    type: 'POST',
                    url: '/ReversalRecord/GetD',
                    data: { "type": tp, "month": monthly, "year": textyear },
                    success: function (data) {
                        $('#tableReversalList').empty();
                        trHTML = '<tr><th>Date</th> <th>Created By</th> <th>Reserved By</th> <th>Date of Reservation</th> <th>Amount</th><th>Description</th><th>Status</th><th>Change Status</th></tr>';
                        $.each(data, function (i, v) {

							trHTML += '<tr><td>' + v.Date + '</td><td>' + v.CreatedBy + '</td><td>' + v.Fullname + '</td><td>' + v.DateofReservation + '</td><td>' + v.Amount + '</td><td>' + v.Description + '</td><td>' + v.Status + '</td><td><select id="rstatus'+v.Id+'" onchange="UpdateStatus(' + v.Id + ')"> <option value="" selected disabled hidden>' + v.Status + '</option><option value="Approved">Approved</option><option value="Denied">Denied</option></select></td><td><button class="btn btn-default" id="btnViewModal" onclick="ViewModal(' + v.RefNo + ')">View Details</button></td></tr>';

                        });
                        $('#tableReversalList').append(trHTML);
                        trHTML = '';

                    },
                    error: function (error) {
                        alert('Failed to retrieve record');
                    }
                });
            }
            function SetC() {
                var s = 'Completed';
                var tp = document.getElementById('cboType').value;
                var textyear = document.getElementById('textyear1').value;
                var monthly = document.getElementById('monthly').value;
                global = s;
                $.ajax({
                    type: 'POST',
                    url: '/ReversalRecord/GetC',
                    data: { "type": tp, "month": monthly, "year": textyear },
                    success: function (data) {
                        $('#tableReversalList').empty();
                        trHTML = '<tr><th>Date</th> <th>Created By</th> <th>Reserved By</th> <th>Date of Reservation</th> <th>Amount</th><th>Description</th><th>Status</th><th>Change Status</th></tr>';
                        $.each(data, function (i, v) {

							trHTML += '<tr><td>' + v.Date + '</td><td>' + v.CreatedBy + '</td><td>' + v.Fullname + '</td><td>' + v.DateofReservation + '</td><td>' + v.Amount + '</td><td>' + v.Description + '</td><td>' + v.Status + '</td><td><select id="rstatus'+v.Id+'" onchange="UpdateStatus(' + v.Id + ')"> <option value="" selected disabled hidden>' + v.Status + '</option><option value="Approved">Approved</option><option value="Denied">Denied</option></select></td><td><button class="btn btn-default" id="btnViewModal" onclick="ViewModal(' + v.RefNo + ')">View Details</button></td></tr>';

                        });
                        $('#tableReversalList').append(trHTML);
                        trHTML = '';

                    },
                    error: function (error) {
                        alert('Failed to retrieve record');
                    }
                });
            }
			function UpdateStatus(id) {
			
                if (confirm('Are you sure?')) {
					var status = document.getElementById('rstatus' + id).value;
                    var data = {
                        Id: id,
                        Status: status
                    };
                    $.ajax({
                        type: 'POST',
                        url: '/ReversalRecord/UpdateStatus',
                        data: data,
                        success: function (data) {
                            window.location.reload();
                        },
                        error: function (data) {
                            alert('failed');
                        }

                    });
                }
            }
            function ViewModal(refno) {
                $('#myModal').modal();
                $.ajax({
                    type: "POST",
                    url: "/ReversalRecord/GetModal",
                    data: { 'refno': refno },
                    success: function (Data) {
                        console.log(Data);
                        $.each(Data, function (i, v) {
                            var s = moment(v.StartTime);
                            var st = s.format("DD/MMM/YYYY hh:mm a");
                            var e = moment(v.EndTime);
                            var et = e.format("DD/MMM/YYYY hh:mm a");
                            $('#myModal #eventTitle').html('<b>Amenity Name: </b>' + v.AName);
                            var $description = $('<div/>');
                            $description.append($('<p/>').html('<b>Reserved By: </b>' + v.ReservedBy));
                            $description.append($('<p/>').html('<b>Building No: </b>' + v.BldgNo));
                            $description.append($('<p/>').html('<b>Unit No: </b>' + v.UnitNo));
                            $description.append($('<p/>').html('<b>StartTime: </b>' + st));
                            $description.append($('<p/>').html('<b>EndTime: </b>' + et));
                            $description.append($('<p/>').html('<b>Amenity Cost: </b>' + v.Rate));
                            $description.append($('<p/>').html('<b>Table Cost: </b>' + v.TableCost));
                            $description.append($('<p/>').html('<b>Chair Cost: </b>' + v.ChairCost));
                            $description.append($('<p/>').html('<b>Charge: </b>' + v.Charge));
                            $description.append($('<p/>').html('<b>Total Cost: </b>' + ((v.Rate + v.TableCost + v.ChairCost + v.Charge))));
                            $description.append($('<p/>').html('<b>Reversal Amount: </b>' + (v.Amount)));
                            $description.append($('<p/>').html('<b>Total Payment: </b>' + (v.Total - v.Amount)));
                            $description.append($('<p/>').html('<b>Outstanding Total: </b>' + ((v.Rate + v.TableCost + v.ChairCost + v.Charge) - (v.Total - v.Amount))));
                            $description.append($('<p/>').html('<b>Status: </b>' + v.Status));

                            document.getElementById('rid').value = v.SRId;
                            document.getElementById('rfid').value = v.RFId;
                            $('#myModal #pDetails').empty().html($description);
                        })


                    },
                    error:
                        function (error) {
                            alert('Failed to retrieve the record');
                        }

                });

            }
            function Set(s) {
                document.getElementById('caption').innerHTML = 'List of ' + s;
                if (s == 'Pending') {
                    SetP();
                }
                else if (s == 'Approved') {
                    SetA();
                }
                else if (s == 'Denied') {
                    SetD();
                }
                else {
                    SetC();
                }
            }
        </script>
    }
