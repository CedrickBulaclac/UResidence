@model List<UResidence.Amenity>

@{
    /**/
    Layout = "/Views/Layout/RegistrationLayout.cshtml";
    ViewBag.Title = "AmenityView";

}

<h2>Amenity</h2>


<div class="container">
    <div class="modal fade" id="addImageModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="file" id="image" name="image" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="btnAdd" name="btnAdd" data-dismiss="modal" onclick="AddImage()">Insert</button>
                    <button type="button" class="btn btn-danger" id="btnCloseImage" name="btnCloseImage" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


@*---Modal for View Amenity Image---*@
<div class="container">
    <div class="modal fade" id="viewImageModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <table id="viewImage" class="table table-bordered"></table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="btnAddModal" name="btnAddModal" data-dismiss="modal">Add Image</button>
                    <button type="button" class="btn btn-danger" id="btnCloseImage" name="btnCloseImage" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

@*---Modal for Update Amenity Image---*@
<div class="container">
    <div class="modal fade" id="updateImageModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="file" id="image1" name="image1" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="btnUpdate" name="btnUpdate" onclick="UpdateImage()" data-dismiss="modal">Update</button>
                    <button type="button" class="btn btn-danger" id="btnCloseImage" name="btnCloseImage" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
@using (Html.BeginForm("AmenityView", "Amenity", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    <hr />
    <div class="dl-horizontal">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>
                        AmenityNo
                    </th>
                    <th>
                        Description
                    </th>
                    <th>
                        Capacity
                    </th>
                    <th>
                        Rate
                    </th>
                    <th>
                        Image
                    </th>
                    <th>
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                    foreach (Amenity a in Model)
                    {

                        <tr>

                            <td>
                                @Html.DisplayFor(model => a.AmenityName)
                            </td>
                            <td>
                                @Html.DisplayFor(model => a.Description)
                            </td>
                            <td>
                                @Html.DisplayFor(model => a.Capacity)
                            </td>
                            <td>
                                @Html.DisplayFor(model => a.Rate)
                            </td>
                            <td>
                                <a class="btn btn-info" id="btnViewImage" name="btnViewImage" onclick="Set(@a.Id)" aria-hidden="true">View Image</a>
                            </td>
                            <td>
                                <a class="btn btn-link" href="@Url.Action("AmenityEdit", "Amenity", new { id = Convert.ToInt32(a.Id) })"><i class="glyphicon glyphicon-edit"></i>EDIT</a>
                                <a class="btn btn-link" href="@Url.Action("Delete", "Amenity", new { id = Convert.ToInt32(a.Id) })"><i class="glyphicon glyphicon-trash"></i> DELETE</a>
                            </td>

                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>


    <div class="btn-link">
        <a href="@Url.Action("AmenityAdd","Amenity")"><input id="btnAdd" type="button" value="ADD NEW AMENITY" class="btn btn-success" /></a>
    </div>


    <div id="auerror" class="alert alert-danger collapse">
        <a href="#" class="close" data-dismiss="alert">&times;</a>
        <strong>Error!</strong> There is a problem updating the Amenity
    </div>
    <div id="ausuccess" class="alert alert-success collapse">
        <strong>Success!</strong> You have successfully updated the Amenity
    </div>


    <div id="aerror" class="alert alert-danger collapse">
        <a href="#" class="close" data-dismiss="alert">&times;</a>
        <strong>Error!</strong> There is a problem deleting the Amenity
    </div>
    <div id="asuccess" class="alert alert-success collapse">
        <strong>Success!</strong> You have successfully deleted the Amenity
    </div>

    <div id="aaerror" class="alert alert-danger collapse">
        <a href="#" class="close" data-dismiss="alert">&times;</a>
        <strong>Error!</strong> There is a problem submitting your Amenity
    </div>
    <div id="aasuccess" class="alert alert-success collapse">
        <strong>Success!</strong> You have successfully added the Amenity
    </div>
    if (ViewBag.DeleteStatus != null)
    {
        if (ViewBag.DeleteStatus == true)
        {
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">
                $(document).ready(function () {

                    $('#asuccess').show('fade');

                    setTimeout(function () {
                        $('#asuccess').hide('fade');
                    }, 2000);
                });
            </script>
        }

        else
        {
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">
                $(document).ready(function () {

                    $('#aerror').show('fade');

                    setTimeout(function () {
                        $('#aerror').hide('fade');
                    }, 2000);


                });
            </script>
        }
    }
    if (ViewBag.UpdateMessage != null)
    {
        if (ViewBag.UpdateMessage == true)
        {
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">
                $(document).ready(function () {

                    $('#ausuccess').show('fade');

                    setTimeout(function () {
                        $('#ausuccess').hide('fade');
                    }, 2000);


                });
            </script>
        }

        else
        {
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">
                $(document).ready(function () {

                    $('#auerror').show('fade');

                    setTimeout(function () {
                        $('#auerror').hide('fade');
                    }, 2000);


                });
            </script>
        }
    }


    if (ViewBag.AddMessage != null)
    {
        if (ViewBag.AddMessage == true)
        {

            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">

                $(document).ready(function () {

                    $('#aasuccess').show('fade');

                    setTimeout(function () {
                        $('#aasuccess').hide('fade');
                    }, 20000);

                });
            </script>
        }

        else
        {
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
            </script>
            <script type="text/javascript">

                $(document).ready(function () {

                    $('#aaerror').show('fade');

                    setTimeout(function () {
                        $('#aaerror').hide('fade');
                    }, 2000);


                });
            </script>

        }

    }


}
<script>
    var iid = 0;
    var uid = 0;
    var mid = 0;
    function Set(id) {
        mid = id;
        ViewImage();
    }

    function AddImage() {
        var file = $("#image").get(0).files;
        var data = new FormData();
        data.append("Image", file[0]);
        data.append("Id", iid);

        $.ajax({
            type: "POST",
            url: "/Amenity/InsertImage/",
            data: data,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == true) {
                    alert('Success');
                    window.location.href = window.location.href + "?rnd=" + Math.random()

                }
            },
            error: function (error) {
                alert(error);
            }
        });
    }

    function ViewImage() {
        var id = mid;
        $('#viewImage').empty();
        var data = {
            Id: id
        };
        iid = id;
        $.ajax({
            type: "POST",
            url: "/Amenity/ViewImage/",
            data: data,
            success: function (data) {
                trHTML = '<tr><th>Image</th> <th>Action</th></tr>';

                $.each(data, function (i, v) {

                    var fullpath = (v.URL).toString();                   
                    var filename = fullpath.replace(/^.*[\\\/]/, '');                 
                    var path = "../Content/AmenityImages/" + filename;
                    trHTML += '<tr><td><img id="amenpic" src="' + path + '" height="200px" width="200px"></td> <td><button id="btnEdit" name="btnEdit" class="btn btn-info" data-dismiss="modal" onclick="SetText(' + v.Id + ')"><i class="glyphicon glyphicon-edit"></i>Edit Image</button>    <button class="btn btn-danger" id="btndelete" name="btnDelete" onclick="Delete(' + v.Id + ', \'' + filename + '\')"><i class="glyphicon glyphicon-trash"></i>Delete</button></td></tr>';
                });
                $('#viewImage').append(trHTML);


            },
            error: function (error) {
                alert(error);
            }
        });
        $('#viewImageModal').modal();
    }
    function Delete(id, name) {
        alert(name);
        var data = {
            Id: id,
            URL: name
        };
        $.ajax({
            type:"POST",
            url: "/Amenity/DeleteImage",
            data: data,
            success: function (data) {
                alert('Deleted Successfully');
                window.location.reload();
            },
            error: function (data) {
                alert('Failed');
            },


        });
    
    }
    function SetText(id) {
        uid = id;
        $('#updateImageModal').modal();

    }
    function UpdateImage() {


        var file = $("#image1").get(0).files;
        var data = new FormData();
        data.append("Image", file[0]);
        data.append("Id", uid);

        $.ajax({
            type: "POST",
            url: "/Amenity/UpdateImage/",
            data: data,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data == true) {
                    alert('Success');
                    window.location.href = window.location.href + "?rnd=" + Math.random()

                }
            },
            error: function (error) {
                alert(error);
            }
        });
    }
    $('#btnAddModal').click(function () {
        $('#addImageModal').modal();

    });
    $('#btnViewImage').click(function () {
        //  $('#viewImageModal').modal();
        //  alert('go');
    });

    $('#btnCloseImage').click(function () {

        $('#updateImageModal').hide();
    }
    );

 
</script>

